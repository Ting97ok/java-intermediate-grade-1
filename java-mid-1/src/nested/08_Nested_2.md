# 8. Nested_2

- 지역 클래스
    - 내부 클래스의 한 종류 → 내부 인스턴스에 접근 가능
    - 지역 변수와 같이 코드 블럭 안에서 정의됨.
    - 특징
        - 자신의 인스턴스 변수에 접근 가능
        - 자신이 속한 코드 블럭의 지역 변수에 접근 가능
        - 자신이 속한 코드 블럭의 매개변수에 접근 가능
        - 바깥 클래스의 인스턴스 멤버에 접근 가능
        - 지역 변수처럼 접근 제어자 사용 불가능
        - 다른 클래스처럼 인터페이스 구현이나 부모 클래스 상속 가능
    - 지역 변수 캡처
        - 변수의 생명 주기
            - 클래스 변수(static 변수) : 클래스 변수는 메서드 영역에 존재하고, 자바가 클래스 정보를 읽어 들이는 순간부터 프로그램 종료까지 존재
            - 인스턴스 변수 : 인스턴스 변수는 힙 영역에 존재하고, 본인이 소속된 인스턴스가 종료되기 전까지 존재
            - 지역 변수 : 지역변수는 스택 영역에 존재하고, 본인이 소속된 메서드 영역이 호출되면 생성되고 메서드가 종료될 때까지 존재한다.
        - main 에서 지역 클래스를 반환 받으면 main이 종료될때까지 생존한다. 다만 지역 클래스 안에서 참조한 바깥의 지역 변수는 반환 되면 바로 사라진다. → 즉 지역 변수는 지역 클래스가 반환되는 시점에 사라지지만 지역 클래스는 반환이 된 후에도 사라지지 않는다
            - 이러한 문제 때문에 지역 클래스는 지역 변수를 복사해서 생성한 인스턴스에 함께 가지고 있는데 이걸 지역 변수 캡처 라고 한다. → 모든 지역 변수를 복사하는것이 아닌 사용하는 지역변수만을 복사
            - 즉 지역 변수가 사라져도 지역 클래스에 복사된 지역 변수 값이 있으므로 그걸 사용한다.
    - 주의점
        - 지역 클래스가 접근하는 지역 변수는 절대 변경되면 안됨.
        - 따라서 final로 선언하거나 사실상 final이어야 함.
            - 사실상 final이란 final 키워드를 사용하지는 않았지만 실제로 final처럼 동작해야 하는 것. → 자바에서는 캡처한 지역 변수를 변경하지 못하게 막아줌.
        - 값을 변경한다면 스택 영역에 존재하는 지역 변수의 값과 인스턴스에 캡처한 캡처 변수의 값이 서로 달라지는 동기화 문제가 발생함.
        - 또 다른 이유
            - 지역 변수의 값을 변경하면 인스턴스에 캡처한 변수의 값도 변경해야 함
            - 반대로 인스턴스에 있는 캡처 변수의 값을 변경하면 해당 지역 변수의 값도 다시 변경해야 함
            - 개발자 입장에서 보면 예상하지 못한 곳에서 값이 변경될 수 있음 → 디버깅 어려움..
            - 지역 변수의 값과 인스턴스에 있는 캡처 변수의 값을 서로 동기화 해야 함 → 멀티쓰레드 상황에서 이런 동기화는 매우 어렵고, 성능에 나쁜 영향을 줄 수 있음
    - 변수 캡처에 대한 내용이 이해가 어렵다면 단순하게 지역 클래스가 접근하는 지역 변수의 값은 변경하면 안된다고 이해하면 충분
- 익명 클래스
    - 지역클래스는 사용하기 위해 선언과 생성을 함. → 익명 클래스는 이걸 전부 생략하고 클래스의 선언과 생성을 한번에 구현할 수 있음
    - new Name() {body} 로 구현이 가능하다. new 다음에 바로 인터페이스 구현을 하거나 클래스를 상속해야 한다. → Name()이라는 상속(구현) 하면서 바로 생성하는 것.
    - 특징
        - 익명 클래스는 이름 없는 지역 클래스를 선언하면서 동시에 생성함
        - 부모 클래스를 상속받거나 인터페이스를 구현해야 함 → 즉 상위 클래스나 인터페이스가 필요함.
        - 익명 클래스는 이름이 없으므로 생성자를 가질 수 없음. (기본 생성자만 사용됨)
        - 지역 클래스가 일회성으로 사용되는 경우나 간단한 구현을 제공할때 사용함
    - 장점
        - 클래스를 별도로 정의하지 않고도 인터페이스나 추상 클래스를 즉석에서 구현할 수 있기 때문에 코드가 간결해짐 → 복잡하거나 재사용이 필요한 경우에는 별도의 클래스를 정의하는 것이 좋음
            - 즉 여러번 재사용이 필요하면 지역 클래스를 사용하는 것이 좋음.
    - 람다
        - 함수를 전달 할 때 더 간단하게 사용하려면 람다를 이용해 해당 함수만 전달할 수 있다.